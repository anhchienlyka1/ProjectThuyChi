<div class="game-container">
    <!-- Race Track Visual Area (Top) -->
    <div class="race-game-visual">
        <!-- Back Button -->
        <button class="back-button" routerLink="/games">
            ‚Üê Tr·ªü l·∫°i
        </button>

        <!-- Header: Timer & Title - Moved inside race track -->
        <div class="game-header">
            <div class="timer-badge">
                ‚è±Ô∏è {{ formattedTime }}
            </div>
            <div class="progress-badge">
                ƒê∆∞·ªùng ƒêua Tr√≠ Tu·ªá
            </div>
        </div>

        <div class="track-container">
            <!-- Background -->
            <div class="track-bg"></div>

            <!-- Finish Line -->
            <div class="finish-line">üèÅ</div>

            <!-- Racers -->
            <!-- Lane 1: Tortoise (Left Player) -->
            <div class="racer-lane lane-1">
                <div class="racer-character tortoise" [style.left.%]="(progressLeft / WIN_SCORE) * 90">
                    <img src="assets/images/games/tug-of-war/rua.png" alt="R√πa">
                </div>
            </div>

            <!-- Lane 2: Hare (Right Player) -->
            <div class="racer-lane lane-2">
                <div class="racer-character hare" [style.left.%]="(progressRight / WIN_SCORE) * 90">
                    <img src="assets/images/games/tug-of-war/tho.png" alt="Th·ªè">
                </div>
            </div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div class="game-board">
        <!-- Split Screen: Left Player (Tortoise) -->
        <div class="player-zone left-player" [class.winner-glow]="winner === 'left'">
            <div class="player-avatar">üê¢ R√πa (B√©)</div>

            <div *ngIf="gameStatus === 'playing' && currentQuestionLeft; else waitingState" class="question-panel">
                <div class="question-text">{{ currentQuestionLeft.text }}</div>
                <div class="options-grid">
                    <button *ngFor="let opt of currentQuestionLeft.options" (click)="handleAnswer('left', opt)"
                        class="option-btn">
                        {{ opt }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Split Screen: Right Player (Hare) -->
        <div class="player-zone right-player" [class.winner-glow]="winner === 'right'">
            <div class="player-avatar">üê∞ Th·ªè (Ba M·∫π)</div>

            <div *ngIf="gameStatus === 'playing' && currentQuestionRight; else waitingState" class="question-panel">
                <div class="question-text">{{ currentQuestionRight.text }}</div>
                <div class="options-grid">
                    <button *ngFor="let opt of currentQuestionRight.options" (click)="handleAnswer('right', opt)"
                        class="option-btn">
                        {{ opt }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- End Game Overlay -->
    <div *ngIf="gameStatus === 'finished'" class="end-overlay">
        <div class="result-card">
            <h1>K·∫øt Th√∫c!</h1>
            <div class="winner-announcement" *ngIf="winner === 'left'">üéä B√© (R√πa) Th·∫Øng! üéä</div>
            <div class="winner-announcement" *ngIf="winner === 'right'">üèÜ Ba M·∫π (Th·ªè) Th·∫Øng! üèÜ</div>
            <div class="winner-announcement" *ngIf="winner === 'draw'">ü§ù H√≤a Nhau! ü§ù</div>

            <div class="actions">
                <kid-button variant="primary" (click)="startGame()">Ch∆°i L·∫°i</kid-button>
                <kid-button variant="neutral" routerLink="/games">Tho√°t</kid-button>
            </div>
        </div>
    </div>

    <ng-template #waitingState>
        <div class="waiting-msg">Chu·∫©n b·ªã...</div>
    </ng-template>
</div>