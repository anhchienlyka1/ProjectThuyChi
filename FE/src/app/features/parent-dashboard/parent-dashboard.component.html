<div class="max-w-7xl mx-auto space-y-6 pt-12">

  <!-- Student Profile Card (Há»“ SÆ¡ Cá»§a BÃ©) -->
  @if (selectedStudent()) {
  <app-student-profile-card [studentId]="selectedStudent()!.id"></app-student-profile-card>
  }

  <!-- Welcome Header -->
  <div class="bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 rounded-3xl p-8 text-white shadow-xl">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold mb-2">ğŸ‘‹ Xin chÃ o, Phá»¥ Huynh!</h1>
        <p class="text-white/90 text-lg">
          @if (selectedStudent()) {
          HÃ´m nay <strong>{{ selectedStudent()?.name }}</strong> Ä‘Ã£ há»c Ä‘Æ°á»£c {{ todayStats().lessonsCompleted
          }} bÃ i vÃ  Ä‘áº¡t {{ todayStats().averageScore }}% Ä‘iá»ƒm trung bÃ¬nh
          } @else {
          HÃ´m nay bÃ© Ä‘Ã£ há»c Ä‘Æ°á»£c {{ todayStats().lessonsCompleted }} bÃ i vÃ  Ä‘áº¡t {{ todayStats().averageScore
          }}% Ä‘iá»ƒm trung bÃ¬nh
          }
        </p>
      </div>
      <div class="hidden md:block">
        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 text-center">
          <div class="text-4xl font-bold">{{ todayStats().totalMinutes }}</div>
          <div class="text-sm text-white/80">PhÃºt há»c hÃ´m nay</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Total Learning Time -->
    <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
      <div class="flex items-center justify-between mb-4">
        <div class="bg-blue-100 rounded-xl p-3">
          <span class="text-3xl">â°</span>
        </div>
        <span class="text-sm font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">Tuáº§n nÃ y</span>
      </div>
      <!-- Updated to use totalTime string from backend -->
      <div class="text-3xl font-bold text-gray-800 mb-1">{{ weekStats().totalTime }}</div>
      <div class="text-sm text-gray-500">Tá»•ng thá»i gian há»c</div>
      <div class="mt-3 flex items-center text-xs text-green-600">
        <span class="mr-1">â†—</span>
        <span>{{ weekStats().timeTrend }} so vá»›i tuáº§n trÆ°á»›c</span>
      </div>
    </div>

    <!-- Completed Lessons -->
    <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
      <div class="flex items-center justify-between mb-4">
        <div class="bg-green-100 rounded-xl p-3">
          <span class="text-3xl">âœ…</span>
        </div>
        <span class="text-sm font-semibold text-green-600 bg-green-50 px-3 py-1 rounded-full">Tuáº§n nÃ y</span>
      </div>
      <div class="text-3xl font-bold text-gray-800 mb-1">{{ weekStats().completedLessons }}</div>
      <div class="text-sm text-gray-500">BÃ i há»c hoÃ n thÃ nh</div>
      <div class="mt-3 flex items-center text-xs text-green-600">
        <span class="mr-1">â†—</span>
        <span>{{ weekStats().lessonsTrend }} bÃ i so vá»›i tuáº§n trÆ°á»›c</span>
      </div>
    </div>

    <!-- Average Score -->
    <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
      <div class="flex items-center justify-between mb-4">
        <div class="bg-yellow-100 rounded-xl p-3">
          <span class="text-3xl">â­</span>
        </div>
        <span class="text-sm font-semibold text-yellow-600 bg-yellow-50 px-3 py-1 rounded-full">Tuáº§n nÃ y</span>
      </div>
      <div class="text-3xl font-bold text-gray-800 mb-1">{{ weekStats().averageScore }}</div>
      <div class="text-sm text-gray-500">Äiá»ƒm trung bÃ¬nh</div>
      <div class="mt-3 flex items-center text-xs text-green-600">
        <span class="mr-1">â†—</span>
        <span>{{ weekStats().scoreTrend }} so vá»›i tuáº§n trÆ°á»›c</span>
      </div>
    </div>

    <!-- Achievements -->
    <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
      <div class="flex items-center justify-between mb-4">
        <div class="bg-purple-100 rounded-xl p-3">
          <span class="text-3xl">ğŸ†</span>
        </div>
        <span class="text-sm font-semibold text-purple-600 bg-purple-50 px-3 py-1 rounded-full">Tá»•ng cá»™ng</span>
      </div>
      <!-- Updated to use badges count from weekStats -->
      <div class="text-3xl font-bold text-gray-800 mb-1">{{ weekStats().badges }}</div>
      <div class="text-sm text-gray-500">Phiáº¿u BÃ© Ngoan Ä‘áº¡t Ä‘Æ°á»£c</div>
      <div class="mt-3 flex items-center text-xs text-purple-600">
        <span class="mr-1">ğŸ‰</span>
        <span>+{{ weekStats().badgesNew }} phiáº¿u má»›i tuáº§n nÃ y</span>
      </div>
    </div>
  </div>

  <!-- Subject Progress -->
  <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">ğŸ“š Tiáº¿n Ä‘á»™ theo mÃ´n há»c</h2>
      <button class="text-sm text-blue-600 hover:text-blue-700 font-semibold">Xem chi tiáº¿t â†’</button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (subject of subjectProgress(); track subject.subject) {
      <div class="border border-gray-200 rounded-xl p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center gap-3 mb-4">
          <div class="text-4xl" [style.filter]="'hue-rotate(' + subject.color + 'deg)'">{{ subject.icon }}
          </div>
          <div class="flex-1">
            <h3 class="font-bold text-gray-800">{{ subject.subject }}</h3>
            <p class="text-xs text-gray-500">{{ subject.completedLessons }}/{{ subject.totalLessons }} bÃ i
            </p>
          </div>
          <div class="text-2xl font-bold" [style.color]="getProgressColor(subject.progress)">
            {{ subject.progress }}%
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div class="h-full rounded-full transition-all duration-500" [style.width.%]="subject.progress"
            [style.background]="getProgressGradient(subject.progress)">
          </div>
        </div>
      </div>
      }
    </div>
  </div>

  <!-- Recent Activities & Achievements -->
  <!-- Recent Activities -->
  <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">ğŸ“ Hoáº¡t Ä‘á»™ng há»c táº­p gáº§n Ä‘Ã¢y</h2>
      <button class="text-sm text-blue-600 hover:text-blue-700 font-semibold">Xem táº¥t cáº£ â†’</button>
    </div>

    <div class="space-y-4">
      @for (activity of recentActivities(); track activity.id) {
      <div class="flex items-center gap-4 p-4 rounded-xl hover:bg-gray-50 transition-colors border border-gray-100">
        <div class="rounded-xl p-3 text-3xl" [style.background]="activity.color + '20'">
          {{ activity.icon }}
        </div>
        <div class="flex-1">
          <h3 class="font-bold text-gray-800">{{ activity.module }}</h3>
          <p class="text-sm text-gray-500">{{ activity.subject }} â€¢ {{ formatTime(activity.timestamp) }}</p>
        </div>
        <div class="text-right">
          <div class="font-bold text-lg" [class]="getScoreClass(activity.score, activity.totalQuestions)">
            {{ activity.score }}/{{ activity.totalQuestions }}
          </div>
          <div class="text-xs text-gray-500">{{ activity.duration }} phÃºt</div>
        </div>
      </div>
      }
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-8 border border-blue-100">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">âš¡ Thao tÃ¡c nhanh</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <button
        class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-all hover:scale-105 text-left border border-gray-100">
        <div class="text-4xl mb-3">â±ï¸</div>
        <h3 class="font-bold text-lg text-gray-800 mb-1">CÃ i Ä‘áº·t thá»i gian</h3>
        <p class="text-sm text-gray-500">Quáº£n lÃ½ thá»i gian há»c má»—i ngÃ y</p>
      </button>

      <button
        class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-all hover:scale-105 text-left border border-gray-100">
        <div class="text-4xl mb-3">ğŸ“Š</div>
        <h3 class="font-bold text-lg text-gray-800 mb-1">BÃ¡o cÃ¡o chi tiáº¿t</h3>
        <p class="text-sm text-gray-500">Xem bÃ¡o cÃ¡o tiáº¿n Ä‘á»™ Ä‘áº§y Ä‘á»§</p>
      </button>

      <button
        class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-all hover:scale-105 text-left border border-gray-100">
        <div class="text-4xl mb-3">ğŸ¯</div>
        <h3 class="font-bold text-lg text-gray-800 mb-1">Äáº·t má»¥c tiÃªu</h3>
        <p class="text-sm text-gray-500">Thiáº¿t láº­p má»¥c tiÃªu há»c táº­p</p>
      </button>

    </div>
  </div>

</div>